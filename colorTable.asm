; byte mapColor(di = [db] color)
section .text
mapColor:
	push bp

	xor bx, bx
	xor cx, cx
	mov si, .colorTable

	push cx
	push word 0x7fff
	push di

	mov bp, sp

	.loop:
		call .compare

		inc cx
	cmp cx, 256
	jl .loop

	pop ax
	pop ax
	pop ax

	pop bp

	ret

.compare:
	xor dx, dx
	mov di, [bp]

	call .addColor
	call .addColor
	call .addColor

	mov ax, [bp + 2]
	cmp ax, dx
	jl .end@1
	.newLower:
		mov [bp + 2], dx
		mov [bp + 4], cx
	.end@1:

	ret

.addColor:
	xor ax, ax

	lodsb
	mov bl, [ds:di]

	sub ax, bx
	jns .end@2
	.neg:
		neg ax
	.end@2:

	add dx, ax
	inc di

	ret

section .data
.colorTable:
	db 0x00, 0x00, 0x00 ; 00
	db 0x00, 0x00, 0xaa ; 01
	db 0x00, 0xaa, 0x00 ; 02
	db 0x00, 0xaa, 0xaa ; 03
	db 0xaa, 0x00, 0x00 ; 04
	db 0xaa, 0x00, 0xaa ; 05
	db 0xaa, 0xaa, 0x00 ; 06
	db 0xaa, 0xaa, 0xaa ; 07
	db 0x55, 0x55, 0x55 ; 08
	db 0x55, 0x55, 0xff ; 09
	db 0x55, 0xff, 0x55 ; 0a
	db 0x55, 0xff, 0xff ; 0b
	db 0xff, 0x55, 0x55 ; 0c
	db 0xff, 0x55, 0xff ; 0d
	db 0xff, 0xff, 0x55 ; 0e
	db 0xff, 0xff, 0xff ; 0f

	db 0x00, 0x00, 0x00 ; 10
	db 0x14, 0x14, 0x14 ; 11
	db 0x20, 0x20, 0x20 ; 12
	db 0x2c, 0x2c, 0x2c ; 13
	db 0x38, 0x38, 0x38 ; 14
	db 0x45, 0x45, 0x45 ; 15
	db 0x51, 0x51, 0x51 ; 16
	db 0x61, 0x61, 0x61 ; 17
	db 0x71, 0x71, 0x71 ; 18
	db 0x82, 0x82, 0x82 ; 19
	db 0x92, 0x92, 0x92 ; 1a
	db 0xa2, 0xa2, 0xa2 ; 1b
	db 0xb6, 0xb6, 0xb6 ; 1c
	db 0xcb, 0xcb, 0xcb ; 1d
	db 0xe3, 0xe3, 0xe3 ; 1e
	db 0xff, 0xff, 0xff ; 1f

	db 0x00, 0x00, 0xff ; 20
	db 0x41, 0x00, 0xff ; 21
	db 0x7d, 0x00, 0xff ; 22
	db 0xbe, 0x00, 0xff ; 23
	db 0xff, 0x00, 0xff ; 24
	db 0xff, 0x00, 0xbe ; 25
	db 0xff, 0x00, 0x7d ; 26
	db 0xff, 0x00, 0x41 ; 27
	db 0xff, 0x00, 0x00 ; 28
	db 0xff, 0x41, 0x00 ; 29
	db 0xff, 0x7d, 0x00 ; 2a
	db 0xff, 0xbe, 0x00 ; 2b
	db 0xff, 0xff, 0x00 ; 2c
	db 0xbe, 0xff, 0x00 ; 2d
	db 0x7d, 0xff, 0x00 ; 2e
	db 0x41, 0xff, 0x00 ; 2f
	db 0x00, 0xff, 0x00 ; 30
	db 0x00, 0xff, 0x41 ; 31
	db 0x00, 0xff, 0x7d ; 32
	db 0x00, 0xff, 0xbe ; 33
	db 0x00, 0xff, 0xff ; 34
	db 0x00, 0xbe, 0xff ; 35
	db 0x00, 0x7d, 0xff ; 36
	db 0x00, 0x41, 0xff ; 37

	db 0x7d, 0x7d, 0xff ; 38
	db 0x9e, 0x7d, 0xff ; 39
	db 0xbe, 0x7d, 0xff ; 3a
	db 0xdf, 0x7d, 0xff ; 3b
	db 0xff, 0x7d, 0xff ; 3c
	db 0xff, 0x7d, 0xdf ; 3d
	db 0xff, 0x7d, 0xbe ; 3e
	db 0xff, 0x7d, 0x9e ; 3f
	db 0xff, 0x7d, 0x7d ; 40
	db 0xff, 0x9e, 0x7d ; 41
	db 0xff, 0xbe, 0x7d ; 42
	db 0xff, 0xdf, 0x7d ; 43
	db 0xff, 0xff, 0x7d ; 44
	db 0xdf, 0xff, 0x7d ; 45
	db 0xbe, 0xff, 0x7d ; 46
	db 0x9e, 0xff, 0x7d ; 47
	db 0x7d, 0xff, 0x7d ; 48
	db 0x7d, 0xff, 0x9e ; 49
	db 0x7d, 0xff, 0xbe ; 4a
	db 0x7d, 0xff, 0xdf ; 4b
	db 0x7d, 0xff, 0xff ; 4c
	db 0x7d, 0xdf, 0xff ; 4d
	db 0x7d, 0xbe, 0xff ; 4e
	db 0x7d, 0x9e, 0xff ; 4f

	db 0xb6, 0xb6, 0xff ; 50
	db 0xc7, 0xb6, 0xff ; 51
	db 0xdb, 0xb6, 0xff ; 52
	db 0xeb, 0xb6, 0xff ; 53
	db 0xff, 0xb6, 0xff ; 54
	db 0xff, 0xb6, 0xeb ; 55
	db 0xff, 0xb6, 0xdb ; 56
	db 0xff, 0xb6, 0xc7 ; 57
	db 0xff, 0xb6, 0xb6 ; 58
	db 0xff, 0xc7, 0xb6 ; 59
	db 0xff, 0xdb, 0xb6 ; 5a
	db 0xff, 0xeb, 0xb6 ; 5b
	db 0xff, 0xff, 0xb6 ; 5c
	db 0xeb, 0xff, 0xb6 ; 5d
	db 0xdb, 0xff, 0xb6 ; 5e
	db 0xc7, 0xff, 0xb6 ; 5f
	db 0xb6, 0xff, 0xb6 ; 60
	db 0xb6, 0xff, 0xc7 ; 61
	db 0xb6, 0xff, 0xdb ; 62
	db 0xb6, 0xff, 0xeb ; 63
	db 0xb6, 0xff, 0xff ; 64
	db 0xb6, 0xeb, 0xff ; 65
	db 0xb6, 0xdb, 0xff ; 66
	db 0xb6, 0xc7, 0xff ; 67

	db 0x00, 0x00, 0x71 ; 68
	db 0x1c, 0x00, 0x71 ; 69
	db 0x38, 0x00, 0x71 ; 6a
	db 0x55, 0x00, 0x71 ; 6b
	db 0x71, 0x00, 0x71 ; 6c
	db 0x71, 0x00, 0x55 ; 6d
	db 0x71, 0x00, 0x38 ; 6e
	db 0x71, 0x00, 0x1c ; 6f
	db 0x71, 0x00, 0x00 ; 70
	db 0x71, 0x1c, 0x00 ; 71
	db 0x71, 0x38, 0x00 ; 72
	db 0x71, 0x55, 0x00 ; 73
	db 0x71, 0x71, 0x00 ; 74
	db 0x55, 0x71, 0x00 ; 75
	db 0x38, 0x71, 0x00 ; 76
	db 0x1c, 0x71, 0x00 ; 77
	db 0x00, 0x71, 0x00 ; 78
	db 0x00, 0x71, 0x1c ; 79
	db 0x00, 0x71, 0x38 ; 7a
	db 0x00, 0x71, 0x55 ; 7b
	db 0x00, 0x71, 0x71 ; 7c
	db 0x00, 0x55, 0x71 ; 7d
	db 0x00, 0x38, 0x71 ; 7e
	db 0x00, 0x1c, 0x71 ; 7f

	db 0x38, 0x38, 0x71 ; 80
	db 0x45, 0x38, 0x71 ; 81
	db 0x55, 0x38, 0x71 ; 82
	db 0x61, 0x38, 0x71 ; 83
	db 0x71, 0x38, 0x71 ; 84
	db 0x71, 0x38, 0x61 ; 85
	db 0x71, 0x38, 0x55 ; 86
	db 0x71, 0x38, 0x45 ; 87
	db 0x71, 0x38, 0x38 ; 88
	db 0x71, 0x45, 0x38 ; 89
	db 0x71, 0x55, 0x38 ; 8a
	db 0x71, 0x61, 0x38 ; 8b
	db 0x71, 0x71, 0x38 ; 8c
	db 0x61, 0x71, 0x38 ; 8d
	db 0x55, 0x71, 0x38 ; 8e
	db 0x45, 0x71, 0x38 ; 8f
	db 0x38, 0x71, 0x38 ; 90
	db 0x38, 0x71, 0x45 ; 91
	db 0x38, 0x71, 0x55 ; 92
	db 0x38, 0x71, 0x61 ; 93
	db 0x38, 0x71, 0x71 ; 94
	db 0x38, 0x61, 0x71 ; 95
	db 0x38, 0x55, 0x71 ; 96
	db 0x38, 0x45, 0x71 ; 97

	db 0x51, 0x51, 0x71 ; 98
	db 0x59, 0x51, 0x71 ; 99
	db 0x61, 0x51, 0x71 ; 9a
	db 0x69, 0x51, 0x71 ; 9b
	db 0x71, 0x51, 0x71 ; 9c
	db 0x71, 0x51, 0x69 ; 9d
	db 0x71, 0x51, 0x61 ; 9e
	db 0x71, 0x51, 0x59 ; 9f
	db 0x71, 0x51, 0x51 ; a0
	db 0x71, 0x59, 0x51 ; a1
	db 0x71, 0x61, 0x51 ; a2
	db 0x71, 0x69, 0x51 ; a3
	db 0x71, 0x71, 0x51 ; a4
	db 0x69, 0x71, 0x51 ; a5
	db 0x61, 0x71, 0x51 ; a6
	db 0x59, 0x71, 0x51 ; a7
	db 0x51, 0x71, 0x51 ; a8
	db 0x51, 0x71, 0x59 ; a9
	db 0x51, 0x71, 0x61 ; aa
	db 0x51, 0x71, 0x69 ; ab
	db 0x51, 0x71, 0x71 ; ac
	db 0x51, 0x69, 0x71 ; ad
	db 0x51, 0x61, 0x71 ; ae
	db 0x51, 0x59, 0x71 ; af

	db 0x00, 0x00, 0x41 ; b0
	db 0x10, 0x00, 0x41 ; b1
	db 0x20, 0x00, 0x41 ; b2
	db 0x30, 0x00, 0x41 ; b3
	db 0x41, 0x00, 0x41 ; b4
	db 0x41, 0x00, 0x30 ; b5
	db 0x41, 0x00, 0x20 ; b6
	db 0x41, 0x00, 0x10 ; b7
	db 0x41, 0x00, 0x00 ; b8
	db 0x41, 0x10, 0x00 ; b9
	db 0x41, 0x20, 0x00 ; ba
	db 0x41, 0x30, 0x00 ; bb
	db 0x41, 0x41, 0x00 ; bc
	db 0x30, 0x41, 0x00 ; bd
	db 0x20, 0x41, 0x00 ; be
	db 0x10, 0x41, 0x00 ; bf
	db 0x00, 0x41, 0x00 ; c0
	db 0x00, 0x41, 0x10 ; c1
	db 0x00, 0x41, 0x20 ; c2
	db 0x00, 0x41, 0x30 ; c3
	db 0x00, 0x41, 0x41 ; c4
	db 0x00, 0x30, 0x41 ; c5
	db 0x00, 0x20, 0x41 ; c6
	db 0x00, 0x10, 0x41 ; c7

	db 0x20, 0x20, 0x41 ; c8
	db 0x28, 0x20, 0x41 ; c9
	db 0x30, 0x20, 0x41 ; ca
	db 0x38, 0x20, 0x41 ; cb
	db 0x41, 0x20, 0x41 ; cc
	db 0x41, 0x20, 0x38 ; cd
	db 0x41, 0x20, 0x30 ; ce
	db 0x41, 0x20, 0x28 ; cf
	db 0x41, 0x20, 0x20 ; d0
	db 0x41, 0x28, 0x20 ; d1
	db 0x41, 0x30, 0x20 ; d2
	db 0x41, 0x38, 0x20 ; d3
	db 0x41, 0x41, 0x20 ; d4
	db 0x38, 0x41, 0x20 ; d5
	db 0x30, 0x41, 0x20 ; d6
	db 0x28, 0x41, 0x20 ; d7
	db 0x20, 0x41, 0x20 ; d8
	db 0x20, 0x41, 0x28 ; d9
	db 0x20, 0x41, 0x30 ; da
	db 0x20, 0x41, 0x38 ; db
	db 0x20, 0x41, 0x41 ; dc
	db 0x20, 0x38, 0x41 ; dd
	db 0x20, 0x30, 0x41 ; de
	db 0x20, 0x28, 0x41 ; df

	db 0x2c, 0x2c, 0x41 ; e0
	db 0x30, 0x2c, 0x41 ; e1
	db 0x34, 0x2c, 0x41 ; e2
	db 0x3c, 0x2c, 0x41 ; e3
	db 0x41, 0x2c, 0x41 ; e4
	db 0x41, 0x2c, 0x3c ; e5
	db 0x41, 0x2c, 0x34 ; e6
	db 0x41, 0x2c, 0x30 ; e7
	db 0x41, 0x2c, 0x2c ; e8
	db 0x41, 0x30, 0x2c ; e9
	db 0x41, 0x34, 0x2c ; ea
	db 0x41, 0x3c, 0x2c ; eb
	db 0x41, 0x41, 0x2c ; ec
	db 0x3c, 0x41, 0x2c ; ed
	db 0x34, 0x41, 0x2c ; ee
	db 0x30, 0x41, 0x2c ; ef
	db 0x2c, 0x41, 0x2c ; f0
	db 0x2c, 0x41, 0x30 ; f1
	db 0x2c, 0x41, 0x34 ; f2
	db 0x2c, 0x41, 0x3c ; f3
	db 0x2c, 0x41, 0x41 ; f4
	db 0x2c, 0x3c, 0x41 ; f5
	db 0x2c, 0x34, 0x41 ; f6
	db 0x2c, 0x30, 0x41 ; f7

	db 0x00, 0x00, 0x00 ; f8
	db 0x00, 0x00, 0x00 ; f9
	db 0x00, 0x00, 0x00 ; fa
	db 0x00, 0x00, 0x00 ; fb
	db 0x00, 0x00, 0x00 ; fc
	db 0x00, 0x00, 0x00 ; fd
	db 0x00, 0x00, 0x00 ; fe
	db 0x00, 0x00, 0x00 ; ff
